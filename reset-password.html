<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore-compat.js"></script>
    <script>
        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const apiKey = getQueryParameter('apiKey');
            const code = getQueryParameter('oobCode');

            if (!apiKey || !code) {
                alert('Missing API key or reset code.');
                return;
            }

            // Initialize Firebase with the API key from the URL
            const firebaseConfig = {
                apiKey: apiKey
            };
            firebase.initializeApp(firebaseConfig);

            const emailField = document.getElementById('email');
            const newPasswordField = document.getElementById('new-password');
            const submitButton = document.getElementById('submit-button');

            // Check if the reset code is valid
            firebase.auth().verifyPasswordResetCode(code)
                .then((email) => {
                    emailField.innerText = `Resetting password for: ${email}`;
                    document.getElementById('reset-form').style.display = 'block';
                })
                .catch((error) => {
                    alert(`Error: ${error.message}`);
                });

            // Reset password when the form is submitted
            submitButton.addEventListener('click', function() {
                const newPassword = newPasswordField.value;

                // Confirm password reset
                firebase.auth().confirmPasswordReset(code, newPassword)
                    .then(() => {
                        alert('Password has been reset successfully.');
                        // Optionally, redirect the user to another page
                        // window.location.href = 'new-page.html';
                    })
                    .catch((error) => {
                        alert(`Error: ${error.message}`);
                    });
            });
        });
    </script>
</head>
<body>
    <h1>Reset Your Password</h1>
    <p id="email"></p>
    <div id="reset-form" style="display: none;">
        <label for="new-password">New Password:</label>
        <input type="password" id="new-password">
        <button id="submit-button">Reset Password</button>
    </div>
</body>
</html>
